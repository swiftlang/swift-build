# Discovered Dependencies

Swift Build can discover dependencies from tools it runs during the build.

## Overview

The way this works is that a task must be constructed to emit a dependency file in one of two formats:

- **Makefile format**, currently used only by `clang` and `swiftc`.  This is literally a make-based file of dependency info, and is also used by makefiles which are using those tools.
- **Dependency info format**, which is an Xcode-defined format described below.

Then the backing class for the xcspec which created the task must supply a `DependencyDataStyle` enum with the path to the file containing the dependency information, during task creation. Then llbuild will process the file in the appropriate format and use the dependencies as part of its dependency database.

## Dependency info format

A file in dependency info format is a list of <opcode/cstring> pairs.  Each opcode is one byte followed by a variable length, null-byte-terminated UTF-8 string. Â  The defined opcodes are:

| Code | Name | Description |
| ---- | ---- | ----------- |
| 0x10 | Input dependency | The string is the absolute path to a file used directly or indirectly as an input to the tool. |
| 0x11 | Missing input dependency | The string is the absolute path to a file the tool tried to use as an input, but which could not be found.  This is useful to observe that a location in a search path was examined but no match was found, so that if a file is placed there (and no other changes were made), a later rebuild will notice that it is now present. |
| 0x40 | Output dependency | An output file generated by the tool. |

There are presently some limitations in Swift Build in processing these codes.  Specifically:

- **Missing input dependency** is presently unimplemented in Swift Build/llbuild.  This was due to concerns that the dependency file would become large and expensive to process and handle.  We have no plans to implement this code.
- **Output dependency** is not yet implemented in Swift Build/llbuild.
